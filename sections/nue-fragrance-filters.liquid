{{ 'nue-fragrance-filters.css' | asset_url | stylesheet_tag }}
{{ 'component-newsletter.css' | asset_url | stylesheet_tag }}
<script src="{{ 'fragrance-filter.js' | asset_url }}" defer="defer"></script>

<style>
  {% comment %} Modal Styles {% endcomment %}
  .nue-fragrance-modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: rgba(0, 0, 0, 0.5);
    z-index: 9999;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 20px;
  }

  .nue-fragrance-modal-container {
    position: relative;
    background-color: #FFFFFF;
    max-width: 485px;
    width: 100%;
    padding: 40px 20px;
    border-radius: 0;
    max-height: 90vh;
    overflow-y: auto;
  }

  @media screen and (min-width: 750px) {
    .nue-fragrance-modal-container {
      padding: 66px 40px;
    }
  }

  .nue-fragrance-modal-close {
    position: absolute;
    top: 20px;
    right: 20px;
    background: none;
    border: none;
    cursor: pointer;
    padding: 10px;
    z-index: 10;
  }

  .nue-fragrance-modal-close:hover {
    opacity: 0.7;
  }

  .nue-fragrance-modal-heading {
    font-size: 40px;
    font-weight: 100;
    line-height: 48px;
    margin-bottom: 38px;
    margin-top: 0;
    color: {{ section.settings.modal_text_color }};
  }

  .nue-fragrance-modal-richtext p {
    font-size: 14px;
    font-weight: 300;
    line-height: 18px;
    margin-bottom: 20px;
  }

  .nue-fragrance-modal-form-label {
    font-size: 18px;
    font-weight: 300;
    line-height: 24px;
    margin-bottom: 20px;
    font-family: Canela, Assistant, sans-serif;
  }

  .nue-fragrance-modal-form {
    margin-top: 30px;
  }

  .nue-fragrance-modal-form .field__input {
    background-color: transparent;
    padding: 12px 50px 12px 16px;
    color: {{ section.settings.modal_text_color }} !important;
  }

  .nue-fragrance-modal-form .field__input::placeholder {
    color: {{ section.settings.modal_text_color }};
    opacity: 0.7;
  }

  .nue-fragrance-modal-form .newsletter-form__button {
    background-color: transparent !important;
  }

  .nue-fragrance-modal-form .newsletter-form__button:hover {
    opacity: 0.7;
  }

  @media screen and (max-width: 749px) {
    .nue-fragrance-modal-heading {
      font-size: 32px;
      line-height: 40px;
      margin-bottom: 24px;
    }

    .nue-fragrance-modal-richtext p {
      font-size: 18px;
      line-height: 26px;
    }

    .nue-fragrance-modal-form-label {
      font-size: 16px;
      line-height: 22px;
    }
  }
</style>

<div class="nue-fragrance-filters page-width">
  <div class="nue-fragrance-filters__grid">
    {% assign has_emotion_blocks = false %}
    {% assign has_scent_blocks = false %}
    
    {% for block in section.blocks %}
      {% if block.settings.filter_type == 'emotion' %}
        {% assign has_emotion_blocks = true %}
      {% elsif block.settings.filter_type == 'scent' %}
        {% assign has_scent_blocks = true %}
      {% endif %}
    {% endfor %}
    
    {% if has_emotion_blocks %}
      <div class="nue-fragrance-filters__column ">
        <h3 class="nue-fragrance-filters__title">Shop by <em>Emotion</em></h3>
        <div class="nue-fragrance-filters__swatches">
          {% for block in section.blocks %}
            {% if block.settings.filter_type == 'emotion' and block.settings.my_material_setting != blank %}
              <div class="nue-fragrance-filter__item" data-open-modal="{% if block.settings.open_modal %}true{% else %}false{% endif %}" {{ block.shopify_attributes }}>
                {% if block.settings.my_material_setting.image != blank %}
                  <div class="nue-fragrance-filter__image">
                    {{ block.settings.my_material_setting.image | image_url: width: 98 | image_tag }}
                  </div>
                {% endif %}
                
                {% if block.settings.my_material_setting.title != blank %}
                  <p class="nue-fragrance-filter__label">{{ block.settings.my_material_setting.title }}</p>
                {% endif %}
              </div>
            {% endif %}
          {% endfor %}
        </div>
      </div>
    {% endif %}
    
    {% if has_scent_blocks %}
      <div class="nue-fragrance-filters__column">
        <h3 class="nue-fragrance-filters__title">Shop by <em>Scent</em></h3>
        <div class="nue-fragrance-filters__swatches">
          {% for block in section.blocks %}
            {% if block.settings.filter_type == 'scent' and block.settings.my_material_setting != blank %}
              <div class="nue-fragrance-filter__item" data-open-modal="{% if block.settings.open_modal %}true{% else %}false{% endif %}" {{ block.shopify_attributes }}>
                {% if block.settings.my_material_setting.image != blank %}
                  <div class="nue-fragrance-filter__image">
                    {{ block.settings.my_material_setting.image | image_url: width: 98 | image_tag }}
                  </div>
                {% endif %}
                
                {% if block.settings.my_material_setting.title != blank %}
                  <p class="nue-fragrance-filter__label">{{ block.settings.my_material_setting.title }}</p>
                {% endif %}
              </div>
            {% endif %}
          {% endfor %}
        </div>
      </div>
    {% endif %}
  </div>
</div>

{% comment %} Modal Structure {% endcomment %}
<div class="nue-fragrance-modal-overlay" id="nueFragranceModal" style="display: none;">
  <div class="nue-fragrance-modal-container" style="background-color: {{ section.settings.modal_background_color }}; color: {{ section.settings.modal_text_color }}; {% if section.settings.modal_background_image %}background-image: url({{ section.settings.modal_background_image | image_url: width: 1000 }}); background-size: cover; background-position: center;{% endif %}">
    <button class="nue-fragrance-modal-close" type="button" aria-label="Close modal">
      <svg width="14" height="13" viewBox="0 0 14 13" fill="none" xmlns="http://www.w3.org/2000/svg">
        <g clip-path="url(#clip0_38_17933)">
          <path d="M1.35938 0.651245L13.0408 12.6512" stroke="{{ section.settings.modal_text_color }}"/>
          <path d="M12.3242 0.651245L0.642773 12.6512" stroke="{{ section.settings.modal_text_color }}"/>
        </g>
        <defs>
          <clipPath id="clip0_38_17933">
            <rect width="14" height="13" fill="white"/>
          </clipPath>
        </defs>
      </svg>
    </button>
    
    <div class="nue-fragrance-modal-content">
      {% if section.settings.modal_heading != blank %}
        <h2 class="nue-fragrance-modal-heading">{{ section.settings.modal_heading }}</h2>
      {% endif %}
      
      {% if section.settings.modal_richtext != blank %}
        <div class="nue-fragrance-modal-richtext">
          {{ section.settings.modal_richtext }}
        </div>
      {% endif %}
      
      <div class="nue-fragrance-modal-form-wrapper">
        {% if section.settings.modal_form_label != blank %}
          <div class="nue-fragrance-modal-form-label">
            {{ section.settings.modal_form_label | newline_to_br }}
          </div>
        {% endif %}
        
        {%- form 'customer', id: 'NueFragranceModalForm', class: 'nue-fragrance-modal-form newsletter-form' -%}
          <input type="hidden" name="contact[tags]" value="newsletter,nue-fragrance-filter">
          <div class="newsletter-form__field-wrapper">
            <div class="field">
              <input
                id="NueFragranceModalEmail"
                type="email"
                name="contact[email]"
                class="field__input"
                value="{{ form.email }}"
                aria-required="true"
                autocorrect="off"
                autocapitalize="off"
                autocomplete="email"
                placeholder="{{ 'newsletter.label' | t }}"
                required
                style="border-color: {{ section.settings.modal_text_color }}; color: {{ section.settings.modal_text_color }} !important;"
              >
              <label class="field__label" for="NueFragranceModalEmail">
                {{ 'newsletter.label' | t }}
              </label>
              <button
                type="submit"
                class="newsletter-form__button field__button"
                name="commit"
                id="NueFragranceModalSubmit"
                aria-label="{{ 'newsletter.button_label' | t }}"
                style="background-color: transparent;"
              >
                <span class="svg-wrapper">
                  <svg width="10" height="18" viewBox="0 0 10 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M1 1L9 9L1 17" stroke="{{ section.settings.modal_text_color }}"/>
                  </svg>
                </span>
              </button>
            </div>
            {%- if form.errors -%}
              <small class="newsletter-form__message form__message" id="NueFragranceModalForm-error">
                {{- form.errors.translated_fields.email | capitalize }}
                {{ form.errors.messages.email -}}
              </small>
            {%- endif -%}
          </div>
          {%- if form.posted_successfully? -%}
            <h3
              class="newsletter-form__message newsletter-form__message--success form__message"
              id="NueFragranceModalForm-success"
              tabindex="-1"
              autofocus
            >
              {{- 'newsletter.success' | t }}
            </h3>
          {%- endif -%}
        {%- endform -%}
      </div>
    </div>
  </div>
</div>

{% schema %}
{
  "name": "NUE Fragrance Filters",
  "settings": [
    {
      "type": "header",
      "content": "Modal Settings"
    },
    {
      "type": "text",
      "id": "modal_heading",
      "label": "Modal Heading",
      "default": "Comfort, Bottled."
    },
    {
      "type": "richtext",
      "id": "modal_richtext",
      "label": "Modal Content",
      "default": "<p>There's a fragrance that feels like home.<br>A fragrance that stirs memories you can't quite place.</p><p>Our next chapter in functional fragrance explores the science of nostalgia: how familiarity can calm the body, soften the edges of stress, and remind you of the comfort you've always carried within.</p><p>It's not about going back in time, it's about finding a way back to yourself.</p>"
    },
    {
      "type": "textarea",
      "id": "modal_form_label",
      "label": "Form Label Text",
      "default": "Be the first to know\nSign up to unlock early access"
    },
    {
      "type": "color",
      "id": "modal_background_color",
      "label": "Modal Background Color",
      "default": "#FFFFFF"
    },
    {
      "type": "color",
      "id": "modal_text_color",
      "label": "Modal Text Color",
      "default": "#5935D6"
    },
    {
      "type": "image_picker",
      "id": "modal_background_image",
      "label": "Modal Background Image",
      "info": "Optional background image for modal"
    }
  ],
  "blocks": [
    {
      "type": "fragrance_filter",
      "name": "Fragrance Filter",
      "settings": [
        {
          "type": "metaobject",
          "id": "my_material_setting",
          "label": "Label",
          "metaobject_type": "fragrance_scents"
        },
        {
          "type": "select",
          "id": "filter_type",
          "label": "Filter Type",
          "options": [
            {
              "value": "emotion",
              "label": "Emotion"
            },
            {
              "value": "scent",
              "label": "Scent"
            }
          ],
          "default": "emotion"
        },
        {
          "type": "checkbox",
          "id": "open_modal",
          "label": "Open modal instead of filter",
          "default": false
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "NUE Fragrance Filters"
    }
  ]
}
{% endschema %}